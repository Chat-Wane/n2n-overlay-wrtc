!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("N2N",[],e):"object"==typeof exports?exports.N2N=e():t.N2N=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){(function(r){function i(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG),t}(e=t.exports=n(5)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var i=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&"%c"===t&&(o=++i)}),t.splice(o,0,r)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=i,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(i())}).call(this,n(4))},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,s,c,a,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}if(o(n=this._events[t]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:c=Array.prototype.slice.call(arguments,1),n.apply(this,c)}else if(i(n))for(c=Array.prototype.slice.call(arguments,1),s=(u=n.slice()).length,a=0;a<s;a++)u[a].apply(this,c);return!0},n.prototype.addListener=function(t,e){var s;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(s=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!r(e))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},n.prototype.removeListener=function(t,e){var n,o,s,c;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=(n=this._events[t]).length,o=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(c=s;c-- >0;)if(n[c]===e||n[c].listener&&n[c].listener===e){o=c;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){(function(t,n){var r="__lodash_hash_undefined__",i=9007199254740991,o="[object Arguments]",s="[object AsyncFunction]",c="[object Function]",a="[object GeneratorFunction]",u="[object Null]",h="[object Object]",l="[object Proxy]",f="[object Undefined]",p=/^\[object .+?Constructor\]$/,d=/^(?:0|[1-9]\d*)$/,v={};v["[object Float32Array]"]=v["[object Float64Array]"]=v["[object Int8Array]"]=v["[object Int16Array]"]=v["[object Int32Array]"]=v["[object Uint8Array]"]=v["[object Uint8ClampedArray]"]=v["[object Uint16Array]"]=v["[object Uint32Array]"]=!0,v[o]=v["[object Array]"]=v["[object ArrayBuffer]"]=v["[object Boolean]"]=v["[object DataView]"]=v["[object Date]"]=v["[object Error]"]=v[c]=v["[object Map]"]=v["[object Number]"]=v[h]=v["[object RegExp]"]=v["[object Set]"]=v["[object String]"]=v["[object WeakMap]"]=!1;var y="object"==typeof t&&t&&t.Object===Object&&t,_="object"==typeof self&&self&&self.Object===Object&&self,m=y||_||Function("return this")(),g="object"==typeof e&&e&&!e.nodeType&&e,b=g&&"object"==typeof n&&n&&!n.nodeType&&n,w=b&&b.exports===g,C=w&&y.process,I=function(){try{return C&&C.binding&&C.binding("util")}catch(t){}}(),F=I&&I.isTypedArray;function j(t,e){return"__proto__"==e?void 0:t[e]}var O=Array.prototype,x=Function.prototype,M=Object.prototype,E=m["__core-js_shared__"],A=x.toString,P=M.hasOwnProperty,T=function(){var t=/[^.]+$/.exec(E&&E.keys&&E.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),L=M.toString,z=A.call(Object),R=RegExp("^"+A.call(P).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),N=w?m.Buffer:void 0,k=m.Symbol,D=m.Uint8Array,S=(N&&N.allocUnsafe,function(t,e){return function(n){return t(e(n))}}(Object.getPrototypeOf,Object)),U=Object.create,$=M.propertyIsEnumerable,B=O.splice,V=k?k.toStringTag:void 0,q=function(){try{var t=ht(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),K=N?N.isBuffer:void 0,J=Math.max,G=Date.now,W=ht(m,"Map"),Z=ht(Object,"create"),H=function(){function t(){}return function(e){if(!wt(e))return{};if(U)return U(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function Q(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function X(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Y(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function tt(t){var e=this.__data__=new X(t);this.size=e.size}function et(t,e,n){(void 0===n||dt(t[e],n))&&(void 0!==n||e in t)||it(t,e,n)}function nt(t,e,n){var r=t[e];P.call(t,e)&&dt(r,n)&&(void 0!==n||e in t)||it(t,e,n)}function rt(t,e){for(var n=t.length;n--;)if(dt(t[n][0],e))return n;return-1}function it(t,e,n){"__proto__"==e&&q?q(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}Q.prototype.clear=function(){this.__data__=Z?Z(null):{},this.size=0},Q.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Q.prototype.get=function(t){var e=this.__data__;if(Z){var n=e[t];return n===r?void 0:n}return P.call(e,t)?e[t]:void 0},Q.prototype.has=function(t){var e=this.__data__;return Z?void 0!==e[t]:P.call(e,t)},Q.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Z&&void 0===e?r:e,this},X.prototype.clear=function(){this.__data__=[],this.size=0},X.prototype.delete=function(t){var e=this.__data__,n=rt(e,t);return!(n<0||(n==e.length-1?e.pop():B.call(e,n,1),--this.size,0))},X.prototype.get=function(t){var e=this.__data__,n=rt(e,t);return n<0?void 0:e[n][1]},X.prototype.has=function(t){return rt(this.__data__,t)>-1},X.prototype.set=function(t,e){var n=this.__data__,r=rt(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Y.prototype.clear=function(){this.size=0,this.__data__={hash:new Q,map:new(W||X),string:new Q}},Y.prototype.delete=function(t){var e=ut(this,t).delete(t);return this.size-=e?1:0,e},Y.prototype.get=function(t){return ut(this,t).get(t)},Y.prototype.has=function(t){return ut(this,t).has(t)},Y.prototype.set=function(t,e){var n=ut(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},tt.prototype.clear=function(){this.__data__=new X,this.size=0},tt.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},tt.prototype.get=function(t){return this.__data__.get(t)},tt.prototype.has=function(t){return this.__data__.has(t)},tt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof X){var r=n.__data__;if(!W||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Y(r)}return n.set(t,e),this.size=n.size,this};var ot=function(t,e,n){for(var r=-1,i=Object(t),o=n(t),s=o.length;s--;){var c=o[++r];if(!1===e(i[c],c,i))break}return t};function st(t){return null==t?void 0===t?f:u:V&&V in Object(t)?function(t){var e=P.call(t,V),n=t[V];try{t[V]=void 0;var r=!0}catch(t){}var i=L.call(t);return r&&(e?t[V]=n:delete t[V]),i}(t):function(t){return L.call(t)}(t)}function ct(t){return Ct(t)&&st(t)==o}function at(t,e,n,r,i){t!==e&&ot(e,function(o,s){if(wt(o))i||(i=new tt),function(t,e,n,r,i,o,s){var c=j(t,n),a=j(e,n),u=s.get(a);if(u)et(t,n,u);else{var l=o?o(c,a,n+"",t,e,s):void 0,f=void 0===l;if(f){var p=yt(a),d=!p&&mt(a),v=!p&&!d&&It(a);l=a,p||d||v?yt(c)?l=c:function(t){return Ct(t)&&_t(t)}(c)?l=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(c):d?(f=!1,l=function(t,e){return t.slice()}(a)):v?(f=!1,l=function(t,e){var n=function(t){var e=new t.constructor(t.byteLength);return new D(e).set(new D(t)),e}(t.buffer);return new t.constructor(n,t.byteOffset,t.length)}(a)):l=[]:function(t){if(!Ct(t)||st(t)!=h)return!1;var e=S(t);if(null===e)return!0;var n=P.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&A.call(n)==z}(a)||vt(a)?(l=c,vt(c)?l=function(t,e,n,r){var i=!n;n||(n={});for(var o=-1,s=e.length;++o<s;){var c=e[o],a=void 0;void 0===a&&(a=t[c]),i?it(n,c,a):nt(n,c,a)}return n}(c,Ft(c)):(!wt(c)||r&&gt(c))&&(l=function(t){return"function"!=typeof t.constructor||ft(t)?{}:H(S(t))}(a))):f=!1}f&&(s.set(a,l),i(l,a,r,o,s),s.delete(a)),et(t,n,l)}}(t,e,s,n,at,r,i);else{var c=r?r(j(t,s),o,s+"",t,e,i):void 0;void 0===c&&(c=o),et(t,s,c)}},Ft)}function ut(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function ht(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!wt(t)||function(t){return!!T&&T in t}(t))&&(gt(t)?R:p).test(function(t){if(null!=t){try{return A.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}(n)?n:void 0}function lt(t,e){var n=typeof t;return!!(e=null==e?i:e)&&("number"==n||"symbol"!=n&&d.test(t))&&t>-1&&t%1==0&&t<e}function ft(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||M)}var pt=function(t){var e=0,n=0;return function(){var r=G(),i=16-(r-n);if(n=r,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(q?function(t,e){return q(t,"toString",{configurable:!0,enumerable:!1,value:function(t){return function(){return t}}(e),writable:!0})}:Ot);function dt(t,e){return t===e||t!=t&&e!=e}var vt=ct(function(){return arguments}())?ct:function(t){return Ct(t)&&P.call(t,"callee")&&!$.call(t,"callee")},yt=Array.isArray;function _t(t){return null!=t&&bt(t.length)&&!gt(t)}var mt=K||function(){return!1};function gt(t){if(!wt(t))return!1;var e=st(t);return e==c||e==a||e==s||e==l}function bt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}function wt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Ct(t){return null!=t&&"object"==typeof t}var It=F?function(t){return function(e){return t(e)}}(F):function(t){return Ct(t)&&bt(t.length)&&!!v[st(t)]};function Ft(t){return _t(t)?function(t,e){var n=yt(t),r=!n&&vt(t),i=!n&&!r&&mt(t),o=!n&&!r&&!i&&It(t),s=n||r||i||o,c=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],a=c.length;for(var u in t)!e&&!P.call(t,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||lt(u,a))||c.push(u);return c}(t,!0):function(t){if(!wt(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=ft(t),n=[];for(var r in t)("constructor"!=r||!e&&P.call(t,r))&&n.push(r);return n}(t)}var jt=function(t){return function(t,e){return pt(function(t,e,n){return e=J(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=J(r.length-e,0),s=Array(o);++i<o;)s[i]=r[e+i];i=-1;for(var c=Array(e+1);++i<e;)c[i]=r[i];return c[e]=n(s),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,c)}}(t,e,Ot),t+"")}(function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,s=i>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(i--,o):void 0,s&&function(t,e,n){if(!wt(n))return!1;var r=typeof e;return!!("number"==r?_t(n)&&lt(e,n.length):"string"==r&&e in n)&&dt(n[e],t)}(n[0],n[1],s)&&(o=i<3?void 0:o,i=1),e=Object(e);++r<i;){var c=n[r];c&&t(e,c,r)}return e})}(function(t,e,n){at(t,e,n)});function Ot(t){return t}n.exports=jt}).call(this,n(7),n(8)(t))},function(t,e,n){"use strict";const r=n(0)("n2n-overlay-wrtc"),i=n(1),o=n(2),s=n(9),c=n(12),a=n(14),u=n(15),h=n(16),l=n(17),f=n(18),p=n(19),d=n(20);t.exports=class extends i{constructor(t={}){super(),this.options=o({pid:s(),peer:s(),retry:5},t),this._bus=new i,this.NI=new d(this,o(o({},this.options),{peer:this.options.peer+"-I"})),this.uni=new c(this.NI,{pid:this.options.pid+"-internal-NI"}),this.NO=new d(this,o(o({},this.options),{peer:this.options.peer+"-O"})),this.uni=new c(this.NO,{pid:this.options.pid+"-internal-NO",retry:this.options.retry}),this.PEER=this.II.peer+"|"+this.IO.peer,r("[%s] registered to ==> %s ==>",this.PID,this.PEER),this.i=new Map,this.o=new Map,this.PID=this.options.pid}_receive(t,e){throw new Error("Message not handled by this protocol.")}_pid(){return this.PID}_bridge(t,e){e.type&&"MConnectTo"===e.type?this.IO.connect(n=>{this.send(t,new a(e.from,e.to,n,e.jobId)).catch(n=>{this.send(t,new p(e.jobId,!1,n)).catch(e=>{console.error("Cant send an ACK to "+t,e)})})}).then(n=>{this.send(t,new p(e.jobId,!0,null)).catch(e=>{console.error("Cant send an ACK to "+t,e)})}).catch(n=>{this.send(t,new p(e.jobId,!1,n)).catch(e=>{console.error("Cant send an ACK to "+t,e)})}):e.type&&"MForwardTo"===e.type?this.send(e.to,new u(e.from,e.to,e.message,e.jobId)).catch(t=>{this.emit(e.jobId,new p(e.jobId,!1,t))}):e.type&&"MForwarded"===e.type&&"MRequest"===e.message.type?this.II.connect(n=>{this.send(t,new a(e.to,e.from,n,e.jobId)).catch(n=>{this.send(t,new p(e.jobId,!1,n)).catch(e=>{console.error("Cant send an ACK to "+t,e)})})},e.message):e.type&&"MForwarded"===e.type&&"MResponse"===e.message.type?this.IO.connect(e.message):"MBridge-status"===e.type&&this._bus.emit(e.jobId,e)}_direct(t,e){r("direct, %s ",t,e),"MDirect"===e.type?this.IO.connect(e=>{this.send(t,e).catch(t=>{})}).then(n=>{this.send(t,new f(e.jobId,!0,null)).catch(t=>{console.error("Please report. (_direct MDirect)")})}).catch(n=>{this.send(t,new f(e.jobId,!1,n)).catch(t=>{console.error("Please report. (_direct MDirect)")})}):"MRequest"===e.type?this.II.connect(e=>{this.send(t,e).catch(t=>{})},e):"MResponse"===e.type?this.IO.connect(e):"MDirect-status"===e.type&&this._bus.emit(e.jobId,e)}send(t,e,n=this.options.retry){let r;if(this.i.has(t))r=this.II.send(t,e,n);else if(this.o.has(t))r=this.IO.send(t,e,n);else{const i=t.substr(0,t.length-2),o=i+"-I",s=i+"-O";r=this.o.has(o)?this.IO.send(o,e,n):this.i.has(s)?this.II.send(s,e,n):new Promise((r,i)=>{const o=s=>{this.IO.send(t,e,0).then(()=>r()).catch(c=>this.II.send(t,e,0).then(()=>r()).catch(t=>{s<n?setTimeout(()=>{o(s+1)},1e3):i(t)}))};o(0)})}return r}stream(t,e,n=this.options.retry){let r;if(this.i.has(t))r=this.II.stream(t,e,n);else if(this.o.has(t))r=this.IO.stream(t,e,n);else{const i=t.substr(0,t.length-2),o=i+"-I",s=i+"-O";r=this.o.has(o)?this.IO.stream(o,e,n):this.i.has(s)?this.II.stream(s,e,n):new Promise((r,i)=>{const o=s=>{this.IO.stream(t,e,0).then(()=>r()).catch(c=>this.II.send(t,e,0).then(()=>r()).catch(t=>{s<n?setTimeout(()=>{o(s+1)},1e3):i(t)}))};o(0)})}return r}connection(t,e){return new Promise((n,i)=>{t?this.IO.connect(e=>this._defaultCallback(this,t)(e)).then(t=>{n(t)}).catch(t=>{i(t)}):this.IO.connect(t=>{r("init signaling offer: ",t),e(t,e=>(r("finalize signaling offer: ",t),this._onReceiveAcceptedOffer(e)))}).then(t=>{n(t)}).catch(t=>{i(t)})})}connectionFromThisToPeer(t){return new Promise((e,n)=>{this.IO.connect(e=>{this.send(t,e,this.options.retry).catch(t=>{n(t)})}).then(t=>{e(t)}).catch(t=>{n(t)})})}connectionFromPeertoThis(t){return new Promise((e,n)=>{const i=s(),o=new l;o.jobId=i,this.send(t,o,this.options.retry).catch(t=>{n(t)}).then(()=>{this._bus.once(i,t=>{r("connectionFromPeertoThis: ",t),!0===t.status?e():n(new Error("the connection between the peer and us has failed"+t.reason))})})})}_defaultCallback(t,e){return n=>{r("init direct offer: ",n),e.acceptOffer(n).then(e=>{r("accepted direct offer: ",e),t._onReceiveAcceptedOffer(e)})}}acceptOffer(t){return new Promise((e,n)=>{this.II.connect(t=>{r("accept signaling offer: ",t),e(t)},t)})}_onReceiveAcceptedOffer(t){this.IO.connect(t)}bridge(t,e){return new Promise((n,i)=>{r("[%s] %s =π= %s =π> %s",this.PID,t,this.PEER,e);const o=s();this.send(t,new h(t,e,o)).catch(t=>{i(t)}),this._bus.once(o,t=>{!0===t.status?n():i(new Error(t.reason))})})}connect(t=null,e=null){return"function"==typeof t&&null===e?(r("%s Connect: from=function, to===null",this.IO.peer),this.IO.connect(e=>t(e))):(r("%s handling n2n connection...",this.IO.peer),null===t||t!==this.IO.peer&&t!==this.II.peer||(t=null),null===e||e!==this.IO.peer&&e!==this.II.peer||(e=null),null!==t&&null!==e?this.bridge(t,e):null!==t?this.connectionFromPeertoThis(t):null!==e?this.connectionFromThisToPeer(e):void 0)}disconnect(t){return void 0===t?Promise.all([this.II.disconnect(),this.IO.disconnect()]):this.i.has(t)?this.II.disconnect(t):this.o.has(t)?this.IO.disconnect(t):Promise.reject(new Error("peer not found"))}neighbours(){return{inview:this.II.neighbours(),outview:this.IO.neighbours()}}uniqNeighbours(t=!1){const e=this.II.neighbours(),n=this.IO.neighbours(),r=[];return e.forEach(t=>{const e=t.peer.substr(0,t.peer.length-2);-1===r.indexOf(e)&&r.push(e)}),n.forEach(t=>{const e=t.peer.substr(0,t.peer.length-2);-1===r.indexOf(e)&&r.push(e)}),t?r.map(t=>t+"-O"):r}getInview(){return new Map(this.i)}getInviewId(){return this.NI.PEER}getOutview(){return new Map(this.o)}getOutviewId(){return this.NO.PEER}}},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var a,u=[],h=!1,l=-1;function f(){h&&a&&(h=!1,a.length?u=a.concat(u):l=-1,u.length&&p())}function p(){if(!h){var t=c(f);h=!0;for(var e=u.length;e;){for(a=u,u=[];++l<e;)a&&a[l].run();l=-1,e=u.length}a=null,h=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function v(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new d(t,e)),1!==u.length||h||c(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){function r(t){var n;function r(){if(r.enabled){var t=r,i=+new Date,o=i-(n||i);t.diff=o,t.prev=n,t.curr=i,n=i;for(var s=new Array(arguments.length),c=0;c<s.length;c++)s[c]=arguments[c];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var a=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;a++;var i=e.formatters[r];if("function"==typeof i){var o=s[a];n=i.call(t,o),s.splice(a,1),a--}return n}),e.formatArgs.call(t,s),(r.log||e.log||console.log.bind(console)).apply(t,s)}}return r.namespace=t,r.enabled=e.enabled(t),r.useColors=e.useColors(),r.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),r.destroy=i,"function"==typeof e.init&&e.init(r),e.instances.push(r),r}function i(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=r.debug=r.default=r).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var o=e.instances[n];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(6),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){var n=1e3,r=6e4,i=36e5,o=24*i;function s(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}t.exports=function(t,e){e=e||{};var c=typeof t;if("string"===c&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var s=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(t);if("number"===c&&!1===isNaN(t))return e.long?function(t){return s(t,o,"day")||s(t,i,"hour")||s(t,r,"minute")||s(t,n,"second")||t+" ms"}(t):function(t){return t>=o?Math.round(t/o)+"d":t>=i?Math.round(t/i)+"h":t>=r?Math.round(t/r)+"m":t>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){var r=n(10),i=n(11);t.exports=function(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e)for(var c=0;c<16;++c)e[o+c]=s[c];return e||i(s)}},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var i=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}},function(t,e){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(t,e){var r=e||0,i=n;return[i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]]].join("")}},function(t,e,n){"use strict";const r=n(0)("unicast-definition"),i=n(1),o=n(2),s=n(13);t.exports=class extends i{constructor(t,e={}){super(),this.options=o({retry:0,pid:"default-unicast"},e),this.psp=t;let n=t._receive;t._receive=((e,r)=>{try{n.call(t,e,r)}catch(t){if(!r.type||"MUnicast"!==r.type||r.pid!==this.options.pid)throw t;this._emit(r.event,...r.args)}}),this._emit=this.emit,this.emit=((e,n,...r)=>t.send(n,new s(this.options.pid,e,r),this.options.retry)),r("just initialized on top of %s@%s.",this.psp.PID,this.psp.PEER)}destroy(){this.removeAllListener(),this.emit=this._emit}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.pid=t,this.event=e,this.args=n,this.type="MUnicast"}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n,r){this.from=t,this.to=e,this.message=n,this.type="MForwardTo",this.jobId=r}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n,r){this.from=t,this.to=e,this.message=n,this.type="MForwarded",this.jobId=r}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.from=t,this.to=e,this.type="MConnectTo",this.jobId=n}}},function(t,e,n){"use strict";t.exports=class{constructor(t){this.type="MDirect",this.jobId=t}}},function(t,e){t.exports=function(t,e=!0,n=null){this.type="MDirect-status",this.jobId=t,this.status=e,this.reason=n}},function(t,e){t.exports=function(t,e=!0,n=null){this.type="MBridge-status",this.jobId=t,this.status=e,this.reason=n}},function(t,e,n){"use strict";const r=n(21);t.exports=class extends r{constructor(t,e){super(e),this._options=e,this._parent=t,this.PID=this._options.pid}_receive(t,e){if(!e.type)throw new Error("Message not handled");if("MConnectTo"===e.type||"MForwarded"===e.type||"MForwardTo"===e.type||"MBridge-status"===e.type)this._parent._bridge(t,e);else{if("MResponse"!==e.type&&"MRequest"!==e.type&&"MDirect"!==e.type&&"MDirect-status"!==e.type)throw new Error("Message not handled");this._parent._direct(t,e)}}_pid(){return this.PID}_received(t,e){this._receive(t,e)}_streamed(t,e){this._parent.emit("stream",t,e)}_connected(t,e){e?(this._parent.o.has(t)||this._parent.o.set(t,0),this._parent.o.set(t,this._parent.o.get(t)+1),this._parent.emit("open",t)):(this._parent.i.has(t)||this._parent.i.set(t,0),this._parent.i.set(t,this._parent.i.get(t)+1))}_disconnected(t){this._parent.o.has(t)?(this._parent.o.set(t,this._parent.o.get(t)-1),this._parent.o.get(t)<=0&&this._parent.o.delete(t),this._parent.emit("close",t)):this._parent.i.has(t)&&(this._parent.i.set(t,this._parent.i.get(t)-1),this._parent.i.get(t)<=0&&this._parent.i.delete(t))}_failed(t,e){e&&this._parent.emit("fail",t)}}},function(t,e){t.exports=class{_connected(t,e){throw new Error("[_connected] not yet implemented.")}_disconnected(t){throw new Error("[_disconnected] not yet implemented.")}_failed(t,e){throw new Error("[_failed] not yet implemented.")}_received(t,e){throw new Error("[_received] not yet implemented.")}_streamed(t,e){throw new Error("[_streamed] not yet implemented.")}}}])});
//# sourceMappingURL=n2n-overlay-wrtc.bundle.min.js.map